# yaml-language-server: $schema=../schemas/logflow-workflow-schema.json
# 简单测试工作流配置
workflow:
  id: "simple_test"
  name: "简单测试工作流"
  description: "用于测试YAML配置功能的简单工作流"
  version: "1.0.0"
  author: "LogFlow System"

# 节点定义
nodes:
  - id: "data_source"
    name: "测试数据源"
    type: "plugin"
    config:
      pluginType: "mock"
      mockType: "SIMPLE"
      recordCount: 5
      dataFormat: "JSON"
      outputKey: "test_data"

  - id: "data_processor"
    name: "数据处理脚本"
    type: "script"
    config:
      scriptEngine: "javascript"
      inputs:
        - key: "test_data"
          alias: "data"
          required: true
          dataType: "array"
          description: "测试数据源"
      outputKey: "processed_data"
      script: |
        // 多输入模式下的数据处理
        var data = typeof data !== 'undefined' ? data : [];
        var result = [];
        for (var i = 0; i < data.length; i++) {
          var item = data[i];
          result.push({
            id: item.id,
            message: 'Processed: ' + item.message,
            timestamp: utils.now()
          });
        }
        logger.info('处理了 ' + result.length + ' 条数据');
        result;

  - id: "output"
    name: "控制台输出"
    type: "notification"
    config:
      providerType: "console"
      inputs:
        - key: "processed_data"
          alias: "processedData"
          required: true
          dataType: "array"
          description: "处理后的数据"
      title: "简单测试工作流结果"
      messageType: "TEXT"
      priority: "NORMAL"
      provider:
        format: "detailed"
        timestamp: true

# 连接关系
connections:
  - from: "data_source"
    to: "data_processor"
    enabled: true

  - from: "data_processor"
    to: "output"
    enabled: true
